"use strict";(self["webpackChunknew_project"]=self["webpackChunknew_project"]||[]).push([[772],{8772:function(t,o,l){l.r(o),l.d(o,{default:function(){return St}});var e=l(6252),i=l(3577);const s={class:"container"},d={class:"container"},a={class:"text-end mt-4"},r={class:"table mt-4"},n=(0,e._)("thead",null,[(0,e._)("tr",null,[(0,e._)("th",{width:"120"}," 分類 "),(0,e._)("th",null,"產品名稱"),(0,e._)("th",{width:"120"}," 原價 "),(0,e._)("th",{width:"120"}," 售價 "),(0,e._)("th",{width:"100"}," 是否啟用 "),(0,e._)("th",{width:"120"}," 編輯 ")])],-1),c={class:"text-end"},p={class:"text-end"},u={key:0,class:"text-success"},h={key:1},m={class:"btn-group"},g=["onClick"],b=["onClick"],_={class:"modal",tabindex:"-1",id:"myModal",ref:"myModal"},f={id:"delProductModal",ref:"delModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},y={class:"modal-dialog"},v={class:"modal-content border-0"},w={class:"modal-header bg-danger text-white"},P=(0,e._)("h5",{id:"delProductModalLabel",class:"modal-title"},[(0,e._)("span",null,"刪除產品")],-1),k={class:"modal-body"},U=(0,e._)("strong",{class:"text-danger"},null,-1),x=(0,e.Uk)(" 商品(刪除後將無法恢復)。 "),M={class:"modal-footer"},D={key:1,class:"spinner-border text-primary",role:"status"},C=(0,e._)("span",{class:"visually-hidden"},"Loading...",-1),$=[C];function I(t,o,l,C,I,V){const j=(0,e.up)("PagesView"),q=(0,e.up)("ModalView");return(0,e.wg)(),(0,e.iD)("div",s,[(0,e._)("div",d,[(0,e._)("div",a,[(0,e._)("button",{class:"btn btn-primary",onClick:o[0]||(o[0]=(...t)=>V.showProductModel&&V.showProductModel(...t))}," 建立新的產品 ")]),(0,e._)("table",r,[n,(0,e._)("tbody",null,[((0,e.wg)(!0),(0,e.iD)(e.HY,null,(0,e.Ko)(I.products,((t,o)=>((0,e.wg)(),(0,e.iD)("tr",{key:o},[(0,e._)("td",null,(0,i.zw)(t.category),1),(0,e._)("td",null,(0,i.zw)(t.title),1),(0,e._)("td",c,(0,i.zw)(t.origin_price),1),(0,e._)("td",p,(0,i.zw)(t.price),1),(0,e._)("td",null,[t.is_enabled?((0,e.wg)(),(0,e.iD)("span",u,"啟用")):((0,e.wg)(),(0,e.iD)("span",h,"未啟用"))]),(0,e._)("td",null,[(0,e._)("div",m,[(0,e._)("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:o=>V.showProductModel(t)}," 編輯 ",8,g),(0,e._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:o=>V.showDeleteModal(t)}," 刪除 ",8,b)])])])))),128))])])]),(0,e.Wm)(j,{pages:I.pagination,onEmitPages:V.getProducts},null,8,["pages","onEmitPages"]),(0,e._)("div",_,[(0,e.Wm)(q,{modaltitle:I.modalTitle,product:I.product,loading:I.loading,isediting:I.isEditing,onHideModel:V.hideModel,onEditProduct:V.editProduct,onUploadProduct:V.uploadProduct},null,8,["modaltitle","product","loading","isediting","onHideModel","onEditProduct","onUploadProduct"])],512),(0,e._)("div",f,[(0,e._)("div",y,[(0,e._)("div",v,[(0,e._)("div",w,[P,(0,e._)("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:o[1]||(o[1]=(...o)=>t.hideModal&&t.hideModal(...o))})]),(0,e._)("div",k,[(0,e.Uk)(" 是否刪除 "+(0,i.zw)(this.product.title)+" ",1),U,x]),(0,e._)("div",M,[(0,e._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:o[2]||(o[2]=(...o)=>t.hideModal&&t.hideModal(...o))}," 取消 "),I.loading?(0,e.kq)("",!0):((0,e.wg)(),(0,e.iD)("button",{key:0,type:"button",class:"btn btn-danger",onClick:o[3]||(o[3]=t=>V.deleteProduct(this.product))}," 確認刪除 ")),I.loading?((0,e.wg)(),(0,e.iD)("div",D,$)):(0,e.kq)("",!0)])])])],512)])}var V=l(7424),j=l.n(V),q=l(9679),L=l(9963);const E={class:"modal-dialog modal-xl"},z={class:"modal-content border-0"},H={class:"modal-header bg-dark text-white"},T={id:"productModalLabel",class:"modal-title"},R=(0,e._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),J={class:"modal-body"},N={class:"row"},O={class:"col-sm-4"},S={class:"mb-2"},Y={class:"mb-3"},Z=(0,e._)("label",{for:"imageUrl",class:"form-label"},"上傳圖片",-1),A={class:"mb-3"},F={key:1,class:"spinner-border text-primary",role:"status"},K=(0,e._)("span",{class:"visually-hidden"},"Loading...",-1),W=[K],B=["src"],G={class:"mb-2"},Q={class:"mb-3"},X=(0,e._)("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),tt=["src"],ot=(0,e._)("h3",{class:"md-3"},"多圖新增",-1),lt={class:"mb-3"},et=(0,e._)("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),it=["onUpdate:modelValue"],st=["src"],dt={key:0},at={key:1},rt={class:"col-sm-8"},nt={class:"mb-3"},ct=(0,e._)("label",{for:"title",class:"form-label"},"標題",-1),pt={class:"row"},ut={class:"mb-3 col-md-6"},ht=(0,e._)("label",{for:"category",class:"form-label"},"分類",-1),mt={class:"mb-3 col-md-6"},gt=(0,e._)("label",{for:"price",class:"form-label"},"單位",-1),bt={class:"row"},_t={class:"mb-3 col-md-6"},ft=(0,e._)("label",{for:"origin_price",class:"form-label"},"原價",-1),yt={class:"mb-3 col-md-6"},vt=(0,e._)("label",{for:"price",class:"form-label"},"售價",-1),wt=(0,e._)("hr",null,null,-1),Pt={class:"mb-3"},kt=(0,e._)("label",{for:"description",class:"form-label"},"產品描述",-1),Ut={class:"mb-3"},xt=(0,e._)("label",{for:"content",class:"form-label"},"說明內容",-1),Mt={class:"mb-3"},Dt={class:"form-check"},Ct=(0,e._)("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),$t={class:"modal-footer"},It={key:1,class:"spinner-border text-primary",role:"status"},Vt=(0,e._)("span",{class:"visually-hidden"},"Loading...",-1),jt=[Vt],qt={key:1,class:"spinner-border text-primary",role:"status"},Lt=(0,e._)("span",{class:"visually-hidden"},"Loading...",-1),Et=[Lt];function zt(t,o,l,s,d,a){return(0,e.wg)(),(0,e.iD)("div",E,[(0,e._)("div",z,[(0,e._)("div",H,[(0,e._)("h5",T,[(0,e._)("span",null,(0,i.zw)(l.modaltitle),1)]),R]),(0,e._)("div",J,[(0,e._)("div",N,[(0,e._)("div",O,[(0,e._)("div",S,[(0,e._)("div",Y,[Z,(0,e._)("input",{ref:"fileInput",type:"file",class:"form-control",placeholder:"上傳圖片",onInput:o[0]||(o[0]=(...t)=>a.fileReader&&a.fileReader(...t))},null,544)]),(0,e._)("div",A,[d.proploading?(0,e.kq)("",!0):((0,e.wg)(),(0,e.iD)("button",{key:0,class:"btn btn-outline-primary btn-sm d-block w-100",onClick:o[1]||(o[1]=(...t)=>a.imgUpload&&a.imgUpload(...t))}," 上傳圖片 ")),d.proploading?((0,e.wg)(),(0,e.iD)("div",F,W)):(0,e.kq)("",!0)]),(0,e._)("img",{class:"img-fluid",src:d.file,alt:""},null,8,B)]),(0,e._)("div",G,[(0,e._)("div",Q,[X,(0,e.wy)((0,e._)("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":o[2]||(o[2]=t=>d.productProp.imageUrl=t)},null,512),[[L.nr,d.productProp.imageUrl]])]),(0,e._)("img",{class:"img-fluid",src:d.productProp.imageUrl,alt:""},null,8,tt)]),ot,(0,e._)("div",null,[((0,e.wg)(!0),(0,e.iD)(e.HY,null,(0,e.Ko)(d.productProp.imagesUrl,((t,o)=>((0,e.wg)(),(0,e.iD)("div",{class:"mb-1",key:o},[(0,e._)("div",lt,[et,(0,e.wy)((0,e._)("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":t=>d.productProp.imagesUrl[o]=t},null,8,it),[[L.nr,d.productProp.imagesUrl[o]]])]),(0,e._)("img",{class:"img-fluid",src:l.product.imagesUrl[o],alt:""},null,8,st)])))),128))]),l.product.imagesUrl[d.productProp.imagesUrl.length-1]||0==d.productProp.imagesUrl?((0,e.wg)(),(0,e.iD)("div",dt,[(0,e._)("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:o[3]||(o[3]=(...t)=>a.addImg&&a.addImg(...t))}," 新增圖片 ")])):((0,e.wg)(),(0,e.iD)("div",at,[(0,e._)("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:o[4]||(o[4]=(...t)=>a.deleteImg&&a.deleteImg(...t))}," 刪除圖片 ")]))]),(0,e._)("div",rt,[(0,e._)("div",nt,[ct,(0,e.wy)((0,e._)("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":o[5]||(o[5]=t=>d.productProp.title=t)},null,512),[[L.nr,d.productProp.title]])]),(0,e._)("div",pt,[(0,e._)("div",ut,[ht,(0,e.wy)((0,e._)("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":o[6]||(o[6]=t=>d.productProp.category=t)},null,512),[[L.nr,d.productProp.category]])]),(0,e._)("div",mt,[gt,(0,e.wy)((0,e._)("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":o[7]||(o[7]=t=>d.productProp.unit=t)},null,512),[[L.nr,d.productProp.unit]])])]),(0,e._)("div",bt,[(0,e._)("div",_t,[ft,(0,e.wy)((0,e._)("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":o[8]||(o[8]=t=>d.productProp.origin_price=t)},null,512),[[L.nr,d.productProp.origin_price,void 0,{number:!0}]])]),(0,e._)("div",yt,[vt,(0,e.wy)((0,e._)("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":o[9]||(o[9]=t=>d.productProp.price=t)},null,512),[[L.nr,d.productProp.price,void 0,{number:!0}]])])]),wt,(0,e._)("div",Pt,[kt,(0,e.wy)((0,e._)("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":o[10]||(o[10]=t=>d.productProp.description=t)},"\r\n              ",512),[[L.nr,d.productProp.description]])]),(0,e._)("div",Ut,[xt,(0,e.wy)((0,e._)("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":o[11]||(o[11]=t=>d.productProp.content=t)},"\r\n              ",512),[[L.nr,d.productProp.content]])]),(0,e._)("div",Mt,[(0,e._)("div",Dt,[(0,e.wy)((0,e._)("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[12]||(o[12]=t=>d.productProp.is_enabled=t)},null,512),[[L.e8,d.productProp.is_enabled]]),Ct])])])])]),(0,e._)("div",$t,[(0,e._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:o[13]||(o[13]=t=>a.hideModel())}," 取消 "),l.isediting?((0,e.wg)(),(0,e.iD)(e.HY,{key:0},[l.loading?(0,e.kq)("",!0):((0,e.wg)(),(0,e.iD)("button",{key:0,type:"button",class:"btn btn-primary",onClick:o[14]||(o[14]=t=>a.editProduct(d.productProp))}," 編輯 ")),l.loading?((0,e.wg)(),(0,e.iD)("div",It,jt)):(0,e.kq)("",!0)],64)):((0,e.wg)(),(0,e.iD)(e.HY,{key:1},[l.loading?(0,e.kq)("",!0):((0,e.wg)(),(0,e.iD)("button",{key:0,type:"button",class:"btn btn-primary",onClick:o[15]||(o[15]=t=>a.uploadProduct(d.productProp))}," 建立 ")),l.loading?((0,e.wg)(),(0,e.iD)("div",qt,Et)):(0,e.kq)("",!0)],64))])])])}var Ht={name:"product-modal",props:["modaltitle","product","loading","isediting"],emits:["hide-model","edit-product","upload-product"],data(){return{file:"modal",productProp:this.product,proploading:!1}},methods:{uploadProduct(t){this.$emit("upload-product",t)},editProduct(t){this.$emit("edit-product",t)},hideModel(){this.$refs.fileInput.value=null,this.file=null,console.log(this.$refs.fileInput.outerHTML),this.$emit("hide-model")},addImg(){this.productProp.imagesUrl.push("")},deleteImg(){this.productProp.imagesUrl.pop()},fileReader(){if("image/jpeg"!==this.$refs.fileInput.files[0].type&&"image/png"!==this.$refs.fileInput.files[0].type)return void alert("僅支援 jpg、png 檔，請重新上傳！");this.file=null;const t=new FileReader;t.readAsDataURL(this.$refs.fileInput.files[0]),t.onload=t=>{this.file=t.target.result}},imgUpload(){if(!this.file)return;this.proploading=!0;const t=new FormData;t.append("file-to-upload",this.$refs.fileInput.files[0]),this.axios.post("https://vue3-course-api.hexschool.io/v2/api/ciye-project/admin/upload",t).then((t=>{this.$refs.fileInput.value=null,this.file=null,console.log(t,"imgUpload"),this.productProp.imagesUrl[0]=t.data.imageUrl,console.log(this.$refs.fileInput.files[0]),this.proploading=!1,alert("上傳成功")})).catch((()=>{alert("上傳失敗")}))}},watch:{"product.title":function(){console.log(this.productProp,this.product),this.productProp=this.product}},mounted(){this.productProp=this.product,console.log("子元建")}},Tt=l(3744);const Rt=(0,Tt.Z)(Ht,[["render",zt]]);var Jt=Rt,Nt={components:{PagesView:q.Z,ModalView:Jt},data(){return{products:null,pagination:{total_pages:"3",has_pre:"1"},loading:!1,loadInput:null,modalTitle:null,isEditing:!1,productModal:null,deleteModal:null,product:{imagesUrl:[]}}},methods:{getProducts(t=1){this.axios.get(`https://vue3-course-api.hexschool.io/v2/api/ciye-project/products?page=${t}`).then((t=>{console.log(t,"getProducts"),this.products=t.data.products,this.pagination=t.data.pagination,this.loading=!1})).catch((t=>{console.log(t,"getProducts")}))},inputCart(t,o=1){console.log("asd"),this.loading=!0;const l={data:{product_id:t,qty:o}};this.axios.post("https://vue3-course-api.hexschool.io/v2/api/ciye-project/cart",l).then((t=>{this.loading=!1,console.log(t),alert("新增成功")})).catch((t=>{console.log(t),this.loading=!1}))},showProductModel(t){t.title?(this.modalTitle="編輯產品",this.isEditing=!0,this.product=JSON.parse(JSON.stringify(t))):(this.modalTitle="新增產品",this.isEditing=!1,this.product={imagesUrl:[]}),this.productModal.show()},showDeleteModal(t){this.deleteModal.show(),this.product=JSON.parse(JSON.stringify(t))},hideModel(){this.productModal.hide(),console.log("hide"),this.deleteModal.hide()},deleteProduct(){this.loading=!0,this.axios.delete(`https://vue3-course-api.hexschool.io/v2/api/ciye-project/admin/product/${this.product.id}`).then((()=>{alert("成功刪除"),this.hideModel(),this.getProducts()})).catch((()=>{}))},uploadProduct(t){this.product=t,this.loading=!0,0===this.product.imagesUrl.length&&(this.product.imagesUrl=[""]);const o={data:this.product};console.log(o,t,"postProduct"),this.axios.post("https://vue3-course-api.hexschool.io/v2/api/ciye-project/admin/product",o).then((t=>{this.loading=!1,console.log(t,"response"),this.hideModel(),this.getProducts()})).catch((t=>{alert("上傳失敗"),console.log(t,"err"),this.loading=!1}))},editProduct(t){this.product=t,this.loading=!0;const o={data:this.product};this.axios.put(`https://vue3-course-api.hexschool.io/v2/api/ciye-project/admin/product/${this.product.id}`,o).then((t=>{console.log(t,"edit"),this.hideModel(),this.getProducts()})).catch((()=>{}))},signinCheck(){const t=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.axios.defaults.headers.common.Authorization=t,this.loading=!0,this.axios.post(" https://vue3-course-api.hexschool.io/v2//api/user/check").then((()=>{this.getProducts()})).catch((()=>{this.$router.push("/login")}))}},mounted(){this.signinCheck(),this.productModal=new(j())(this.$refs.myModal),this.deleteModal=new(j())(this.$refs.delModal),this.getProducts()}};const Ot=(0,Tt.Z)(Nt,[["render",I]]);var St=Ot}}]);
//# sourceMappingURL=772.81a1881c.js.map