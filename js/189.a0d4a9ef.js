"use strict";(self["webpackChunknew_project"]=self["webpackChunknew_project"]||[]).push([[189],{6189:function(e,l,t){t.r(l),t.d(l,{default:function(){return ve}});var d=t(6252),o=t(3577);const a={class:"container"},s={class:"container"},r={class:"table mt-4"},n=(0,d._)("thead",null,[(0,d._)("tr",null,[(0,d._)("th",null,"購買時間"),(0,d._)("th",null,"Email"),(0,d._)("th",null,"購買款項"),(0,d._)("th",null,"應付金額"),(0,d._)("th",null,"是否付款"),(0,d._)("th",null,"編輯")])],-1),i={class:"list-unstyled"},u={key:0,class:"text-success"},c={key:1},p=["onClick"],h=["onClick"],_={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"orderModal"},g={id:"delProductModal",ref:"delModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},b={class:"modal-dialog"},w={class:"modal-content border-0"},m={class:"modal-header bg-danger text-white"},y=(0,d._)("h5",{id:"delProductModalLabel",class:"modal-title"},[(0,d._)("span",null,"刪除產品")],-1),k=(0,d._)("div",{class:"modal-body"},[(0,d.Uk)(" 是否刪除 "),(0,d._)("strong",{class:"text-danger"}),(0,d.Uk)(" 商品(刪除後將無法恢復)。 ")],-1),O={class:"modal-footer"},v={key:2,class:"spinner-border text-primary",role:"status"},x=(0,d._)("span",{class:"visually-hidden"},"Loading...",-1),D=[x];function M(e,l,t,x,M,f){const z=(0,d.up)("PagesView"),C=(0,d.up)("OrderModal");return(0,d.wg)(),(0,d.iD)("div",a,[(0,d._)("div",s,[(0,d._)("table",r,[n,(0,d._)("tbody",null,[((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(M.orders,(e=>((0,d.wg)(),(0,d.iD)("tr",{key:e.id},[(0,d._)("td",null,(0,o.zw)(new Date(1e3*e.create_at).toLocaleDateString()),1),(0,d._)("td",null,(0,o.zw)(e.user.email),1),(0,d._)("td",null,[(0,d._)("ul",i,[((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(e.orders,((e,l)=>((0,d.wg)(),(0,d.iD)("li",{key:l},(0,o.zw)(e.product.title)+" 數量："+(0,o.zw)(e.qty)+" "+(0,o.zw)(e.product.unit)+" 單價 "+(0,o.zw)(e.product.price),1)))),128))])]),(0,d._)("td",null,(0,o.zw)(e.total),1),(0,d._)("td",null,[e.is_paid?((0,d.wg)(),(0,d.iD)("span",u,"付款完成")):((0,d.wg)(),(0,d.iD)("span",c,"尚未付款"))]),(0,d._)("td",null,[(0,d._)("button",{class:"btn btn-outline-primary btn-sm",onClick:l=>f.showOrderModel(e)},"詳細",8,p),(0,d._)("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:l=>f.showDeleteModal(e)}," 刪除 ",8,h)])])))),128))])])]),(0,d.Wm)(z,{pages:M.pagination,onEmitPages:f.getOrders},null,8,["pages","onEmitPages"]),(0,d._)("div",_,[(0,d.Wm)(C,{loading:M.loading,order:M.order,onUpdateOrder:f.updateOrder},null,8,["loading","order","onUpdateOrder"])],512),(0,d._)("div",g,[(0,d._)("div",b,[(0,d._)("div",w,[(0,d._)("div",m,[y,(0,d._)("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:l[0]||(l[0]=(...e)=>f.hideModal&&f.hideModal(...e))})]),k,(0,d._)("div",O,[M.loading?(0,d.kq)("",!0):((0,d.wg)(),(0,d.iD)("button",{key:0,type:"button",class:"btn btn-outline-secondary",onClick:l[1]||(l[1]=(...e)=>f.hideModal&&f.hideModal(...e))}," 取消 ")),M.loading?(0,d.kq)("",!0):((0,d.wg)(),(0,d.iD)("button",{key:1,type:"button",class:"btn btn-danger",onClick:l[2]||(l[2]=e=>f.deleteProduct(this.order))}," 確認刪除 ")),M.loading?((0,d.wg)(),(0,d.iD)("div",v,D)):(0,d.kq)("",!0)])])])],512)])}var f=t(7424),z=t.n(f),C=t(9679),P=t(9963);const $={class:"modal-dialog modal-xl",role:"document"},q={class:"modal-content border-0"},L=(0,d._)("div",{class:"modal-header bg-dark text-white"},[(0,d._)("h5",{class:"modal-title",id:"exampleModalLabel"},[(0,d._)("span",null,"訂單細節")]),(0,d._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),j={class:"modal-body"},U={class:"row"},E={class:"col-md-4"},H=(0,d._)("h3",null,"用戶資料",-1),K={class:"table"},V={key:0},Y=(0,d._)("th",{style:{width:"100px"}},"姓名",-1),Z=(0,d._)("th",null,"Email",-1),S=(0,d._)("th",null,"電話",-1),T=(0,d._)("th",null,"地址",-1),W={class:"col-md-8"},A=(0,d._)("h3",null,"訂單細節",-1),B={class:"table"},I=(0,d._)("th",{style:{width:"100px"}},"訂單編號",-1),F=(0,d._)("th",null,"下單時間",-1),G=(0,d._)("th",null,"付款時間",-1),J={key:0},N={key:1},Q=(0,d._)("th",null,"付款狀態",-1),R={key:0,class:"text-success"},X={key:1,class:"text-muted"},ee=(0,d._)("th",null,"總金額",-1),le=(0,d._)("h3",null,"選購商品",-1),te={class:"table"},de=(0,d._)("thead",null,[(0,d._)("tr",null,[(0,d._)("th",null,"商品名稱"),(0,d._)("th",null,"數量/單位"),(0,d._)("th",{class:"text-end"},"總價")])],-1),oe={class:"text-end"},ae={class:"d-flex justify-content-end"},se={class:"form-check"},re={class:"form-check-label",for:"flexCheckDefault"},ne={key:0},ie={key:1},ue={class:"modal-footer"},ce={key:0,type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},pe={key:2,class:"spinner-border text-primary",role:"status"},he=(0,d._)("span",{class:"visually-hidden"},"Loading...",-1),_e=[he];function ge(e,l,t,a,s,r){return(0,d.wg)(),(0,d.iD)("div",$,[(0,d._)("div",q,[L,(0,d._)("div",j,[(0,d._)("div",U,[(0,d._)("div",E,[H,(0,d._)("table",K,[s.propsOrder.user?((0,d.wg)(),(0,d.iD)("tbody",V,[(0,d._)("tr",null,[Y,(0,d._)("td",null,(0,o.zw)(s.propsOrder.user.name),1)]),(0,d._)("tr",null,[Z,(0,d._)("td",null,(0,o.zw)(s.propsOrder.user.email),1)]),(0,d._)("tr",null,[S,(0,d._)("td",null,(0,o.zw)(s.propsOrder.user.tel),1)]),(0,d._)("tr",null,[T,(0,d._)("td",null,(0,o.zw)(s.propsOrder.user.address),1)])])):(0,d.kq)("",!0)])]),(0,d._)("div",W,[A,(0,d._)("table",B,[(0,d._)("tbody",null,[(0,d._)("tr",null,[I,(0,d._)("td",null,(0,o.zw)(s.propsOrder.id),1)]),(0,d._)("tr",null,[F,(0,d._)("td",null,(0,o.zw)(new Date(1e3*s.propsOrder.create_at).toLocaleDateString()),1)]),(0,d._)("tr",null,[G,(0,d._)("td",null,[s.propsOrder.paid_date?((0,d.wg)(),(0,d.iD)("span",J,(0,o.zw)(s.propsOrder.paid_date),1)):((0,d.wg)(),(0,d.iD)("span",N,"時間不正確"))])]),(0,d._)("tr",null,[Q,(0,d._)("td",null,[s.propsOrder.is_paid?((0,d.wg)(),(0,d.iD)("strong",R,"已付款")):((0,d.wg)(),(0,d.iD)("span",X,"尚未付款"))])]),(0,d._)("tr",null,[ee,(0,d._)("td",null,(0,o.zw)(s.propsOrder.total),1)])])]),le,(0,d._)("table",te,[de,(0,d._)("tbody",null,[((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(s.propsOrder.products,(e=>((0,d.wg)(),(0,d.iD)("tr",{key:e.id},[(0,d._)("th",null,(0,o.zw)(e.product.title),1),(0,d._)("td",null,(0,o.zw)(e.qty)+" / "+(0,o.zw)(e.product.unit),1),(0,d._)("td",oe,(0,o.zw)(e.final_total),1)])))),128))])]),(0,d._)("div",ae,[(0,d._)("div",se,[(0,d.wy)((0,d._)("input",{class:"form-check-input",type:"checkbox",value:"","onUpdate:modelValue":l[0]||(l[0]=e=>s.propsOrder.is_paid=e),id:"flexCheckDefault"},null,512),[[P.e8,s.propsOrder.is_paid]]),(0,d._)("label",re,[s.propsOrder.is_paid?((0,d.wg)(),(0,d.iD)("span",ne,"已付款")):((0,d.wg)(),(0,d.iD)("span",ie,"未付款"))])])])])])]),(0,d._)("div",ue,[t.loading?(0,d.kq)("",!0):((0,d.wg)(),(0,d.iD)("button",ce," 取消 ")),t.loading?(0,d.kq)("",!0):((0,d.wg)(),(0,d.iD)("button",{key:1,type:"button",class:"btn btn-primary",onClick:l[1]||(l[1]=e=>r.updateOrder(s.propsOrder))}," 修改付款狀態 ")),t.loading?((0,d.wg)(),(0,d.iD)("div",pe,_e)):(0,d.kq)("",!0)])])])}var be={props:{order:{type:Object,default(){return{}}},loading:{type:Boolean,default(){return!1}}},data(){return{status:{},modal:"",propsOrder:{},isPaid:!1}},emits:["update-order"],methods:{updateOrder(e){this.$emit("update-order",e)}},watch:{order(){this.propsOrder=this.order}},mounted(){}},we=t(3744);const me=(0,we.Z)(be,[["render",ge]]);var ye=me,ke={components:{PagesView:C.Z,OrderModal:ye},data(){return{orders:null,order:{},pagination:{},loading:!1,loadInput:null,modalTitle:null,isEditing:!1,orderModal:null,deleteModal:null,product:{imagesUrl:[]}}},methods:{getOrders(e=1){this.axios.get(`https://vue3-course-api.hexschool.io/v2/api/ciye-project/admin/orders?page=${e}`).then((e=>{this.orders=e.data.orders,this.pagination=e.data.pagination,console.log(e.data,"getOrders"),this.loading=!1})).catch((e=>{console.log(e,"getOrders")}))},showOrderModel(e){console.log(e,"cli"),this.order=e,this.orderModal.show()},updateOrder(e){const l={data:{is_paid:e.is_paid}};this.loading=!0;const t=`https://vue3-course-api.hexschool.io/v2/api/ciye-project/admin/order/${e.id}`;this.axios.put(t,l).then((e=>{console.log(e,"updateOrder"),this.orderModal.hide(),this.getOrders(),alert("更改完成")})).catch((e=>{console.log(e,"getOrders")}))},showDeleteModal(e){this.deleteModal.show(),this.order=e},hideModal(){console.log("hide"),this.deleteModal.hide()},deleteProduct(e){this.loading=!0;const l=`https://vue3-course-api.hexschool.io/v2/api/ciye-project/admin/order/${e.id}`;console.log(l),this.axios.delete(l).then((e=>{console.log(e,"delete"),alert("成功刪除"),this.hideModal(),this.getOrders()})).catch((e=>{console.log(e,"daltet")}))},signinCheck(){const e=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.axios.defaults.headers.common.Authorization=e,this.loading=!0,this.axios.post(" https://vue3-course-api.hexschool.io/v2//api/user/check").then((()=>{this.getOrders()})).catch((()=>{this.$router.push("/login")}))}},mounted(){this.signinCheck(),this.deleteModal=new(z())(this.$refs.delModal),this.orderModal=new(z())(this.$refs.orderModal)}};const Oe=(0,we.Z)(ke,[["render",M]]);var ve=Oe}}]);
//# sourceMappingURL=189.a0d4a9ef.js.map